**Билет 28. Запросы с подзапросами в языке SQL**

### Определение и места использования
Подзапрос — `SELECT` внутри другого запроса. Может быть в:
- `SELECT` (скалярный подзапрос),
- `FROM` (производная таблица),
- `WHERE` / `HAVING` (условие фильтрации),
- `EXISTS` / `NOT EXISTS`.

### Типы подзапросов
- **Некоррелированный**: выполняется один раз, независимо от внешнего запроса.  
- **Коррелированный**: зависит от значений внешнего запроса → выполняется для каждой строки.

### Примеры
**Скалярный подзапрос** (в `SELECT`):  
```sql
SELECT name, (SELECT AVG(salary) FROM employees) AS avg_salary
FROM employees;
```

**В `WHERE` (некоррелированный)**:  
```sql
SELECT name FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```

**Коррелированный запрос**:  
```sql
SELECT e1.name
FROM employees e1
WHERE e1.salary > (
  SELECT AVG(e2.salary)
  FROM employees e2
  WHERE e2.department = e1.department
);
```

### Кванторы `ANY` и `ALL`
- `> ANY (...)` — больше **хотя бы одного** значения.  
- `> ALL (...)` — больше **всех** значений.

**Пример**:  
```sql
-- Найти сотрудников с зарплатой выше минимальной в IT
SELECT name FROM employees
WHERE salary > ANY (
  SELECT salary FROM employees WHERE department = 'IT'
);

-- Найти сотрудников с зарплатой выше максимальной в IT
SELECT name FROM employees
WHERE salary > ALL (
  SELECT salary FROM employees WHERE department = 'IT'
);
```

Подзапросы мощны, но могут снижать производительность — особенно коррелированные.

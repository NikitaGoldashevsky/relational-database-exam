**Билет 32. Представления (View) в языке SQL**

### Определение и типы
- **Представление (VIEW)** — виртуальная таблица, определяемая запросом.
- **Типы**:  
  - **Обычные (виртуальные)** — данные не хранятся, запрос выполняется при обращении.  
  - **Материализованные (Materialized Views)** — данные физически сохраняются и обновляются по расписанию или вручную (PostgreSQL поддерживает).

### Синтаксис создания
```sql
CREATE [OR REPLACE] VIEW view_name [(col_list)] AS
SELECT ... FROM ... WHERE ...;
```

**Пример**:  
```sql
CREATE VIEW active_users AS
SELECT id, name, email FROM users WHERE last_login > NOW() - INTERVAL '30 days';
```

### Обновляемые представления
Представление можно использовать в `INSERT`/`UPDATE`/`DELETE`, если оно:
- основано на **одной таблице**,
- не содержит `DISTINCT`, `GROUP BY`, `HAVING`, агрегатных функций, `UNION`, подзапросов в `SELECT`,
- включает первичный ключ базовой таблицы.

**Пример обновляемого VIEW**:  
```sql
CREATE VIEW user_emails AS SELECT id, email FROM users;
UPDATE user_emails SET email = 'new@example.com' WHERE id = 5; -- работает
```

### Ограничения
- Изменения через VIEW применяются к **базовой таблице**.
- Материализованные VIEW **не обновляемы** напрямую — требуется `REFRESH MATERIALIZED VIEW`.

Представления упрощают сложные запросы, обеспечивают безопасность (ограничение доступа) и логическую абстракцию.

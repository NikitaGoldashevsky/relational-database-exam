**Билет 29. Экзистенциальные запросы в языке SQL**

### Операторы `EXISTS` и `NOT EXISTS`
- **Назначение**: проверка наличия (или отсутствия) строк, удовлетворяющих условию.
- **Синтаксис**:  
  ```sql
  SELECT ... FROM R WHERE EXISTS (SELECT 1 FROM S WHERE ...);
  ```
- **Особенности**:  
  - Подзапрос обычно **коррелированный**.  
  - Возвращаемые столбцы не важны — достаточно `SELECT 1` или `SELECT *`.  
  - `EXISTS` возвращает `TRUE`, если подзапрос возвращает ≥1 строку.  
  - `NOT EXISTS` — логическое отрицание.

### Примеры
**Найти клиентов, сделавших хотя бы один заказ**:  
```sql
SELECT name FROM customers c
WHERE EXISTS (
  SELECT 1 FROM orders o WHERE o.customer_id = c.id
);
```

**Найти клиентов без заказов**:  
```sql
SELECT name FROM customers c
WHERE NOT EXISTS (
  SELECT 1 FROM orders o WHERE o.customer_id = c.id
);
```

### Реализация реляционного деления
Задача: найти студентов, записавшихся на **все** курсы.  
Пусть:  
- `Students(id, name)`  
- `Courses(id)`  
- `Enrollments(student_id, course_id)`

**Решение через двойное `NOT EXISTS`**:  
```sql
SELECT s.name
FROM Students s
WHERE NOT EXISTS (
  SELECT 1 FROM Courses c
  WHERE NOT EXISTS (
    SELECT 1 FROM Enrollments e
    WHERE e.student_id = s.id AND e.course_id = c.id
  )
);
```

Логика:  
> «Нет такого курса, на который студент **не** записан» → значит, записан на все.

Это классический шаблон деления в SQL.
